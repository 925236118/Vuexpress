import{r as d,g as T,a as $,o as f,c as g,b as u,e as c,f as i,w as v,u as m,i as w,F,h as J,v as S,n as L,t as h}from"./index-73e58435.js";const O={class:"message-list"},b={class:"username"},E={class:"datetime"},U={class:"content"},R={__name:"Chat",setup(z){let r=d(null),_=d(!1),a=d(""),o=d(""),l=d([]);const y=()=>{let e=new WebSocket("ws://127.0.0.1:3000/chat");return e.onopen=()=>{l.value.push({type:"info",username:"你",content:"连接成功",time:new Date}),_.value=!0,e.send(JSON.stringify({type:"server",username:o.value,content:"connected",time:new Date}))},e.onmessage=n=>{let t=JSON.parse(n.data);["info","error","message"].includes(t.type)?l.value.push(t):t.type==="echo"?(t.username="你",l.value.push(t)):t.type==="init"&&(l.value=[...l.value.filter(p=>["info","error"].includes(p.type)),...t.content])},e.onclose=()=>{l.value.push({type:"info",username:"你",content:"连接断开",time:new Date}),_.value=!1},e},C=()=>{r.value.readyState===1&&r.value.close(),r.value=y()},D=()=>{if(!o.value){l.value.push({type:"error",username:"你",content:"用户名不能为空",time:new Date});return}r.value=y()},V=()=>{r.value.close()},k=e=>{if(!e)return"";e=new Date(e);let n=e.getFullYear(),t=("0"+e.getMonth()).slice(-2),s=("0"+e.getDate()).slice(-2),p=("0"+e.getHours()).slice(-2),B=("0"+e.getMinutes()).slice(-2),M=("0"+e.getSeconds()).slice(-2);return`${n}/${t}/${s} ${p}:${B}:${M}`},N=()=>{if(!a.value)return;let e={type:"message",username:o.value,content:a.value,time:new Date};r.value.send(JSON.stringify(e)),a.value=""},x=T(()=>{let e=[];for(let n=l.value.length-1;n>=0;n--)e.push(l.value[n]);return e});return(e,n)=>{const t=$("Button");return f(),g("div",null,[u(" Chat page "),c("div",null,[i(t,{onClick:D},{default:v(()=>[u("连接")]),_:1}),i(t,{onClick:C},{default:v(()=>[u("重新连接")]),_:1}),i(t,{onClick:V},{default:v(()=>[u("断开连接")]),_:1})]),c("div",null,[i(m(S.Input),{modelValue:m(o),"onUpdate:modelValue":n[0]||(n[0]=s=>w(o)?o.value=s:o=s),placeholder:"用户名"},null,8,["modelValue"]),i(m(S.Input),{modelValue:m(a),"onUpdate:modelValue":n[1]||(n[1]=s=>w(a)?a.value=s:a=s),placeholder:"消息内容"},null,8,["modelValue"]),i(t,{onClick:N},{default:v(()=>[u("发送数据")]),_:1})]),c("ul",O,[(f(!0),g(F,null,J(x.value,(s,p)=>(f(),g("li",{key:p,class:L([s.type,"message-item"])},[c("span",b,h(s.username),1),u(" @ "),c("span",E,h(k(s.time)),1),u(" : "),c("span",U,h(s.content),1)],2))),128))])])}}};export{R as default};
